(window.msfast_searchux_sb_jsonp=window.msfast_searchux_sb_jsonp||[]).push([["cpl-exit~cpl-host~cpl-invoker~cpl-no-submit~pp-comp~stream"],{NQus:function(e,t,a){"use strict";function r(e){var t=0,a=(e||"").trim().replace(/\s+/," ");return a&&(t=a.length),{characterCount:t,wordCount:0,wordLengths:[]}}a.d(t,"a",(function(){return r}))},zH9T:function(e,t,a){"use strict";a.d(t,"a",(function(){return O}));var r=a("wuwP"),i=a("CVAo"),n=a("anwg"),o=a("Ak5F");var s=a("Az8T");a("g5mr"),a("S/Ck"),a("vy+U");function c(e){return e&&Object(s.a)(e,(function(e){return"string"==typeof e||"number"==typeof e?e:JSON.stringify(e)}))}a("25hB");var d=a("ohlq");function p(e){var t={LogicalId:e.logicalSearchId,ConversationId:e.conversationId,TraceId:e.traceId,Version:2,LocalTime:Object(n.a)(e.localTimeOverride||new Date),ImpressionType:e.impressionType,ScenarioName:e.scenarioName,ProviderName:e.providerName,Results:e.dataSourceEntities,Part:e.part||0};Object(o.a)({eventType:"USAGE",name:"ClientDataSource",properties:Object(r.__assign)({},c(t))})}var u=a("W4Bk");function l(e){var t=e.logicalSearchId,a=e.conversationId,i=e.layoutType,s=e.resultsView,d=e.nameDetail,p=function(e){var t=e.logicalSearchId,a=void 0===t?Object(u.a)():t,r=e.conversationId,i=e.layoutType,o=e.resultsView,s=e.part,c=e.verticalType,d=e.pageNumber,p=e.metadata;return{LogicalId:a,ConversationId:r,Version:2,LocalTime:Object(n.a)(new Date),LayoutType:i,Part:s,ResultsView:o,VerticalType:c,PageNumber:d,metadata:p}}({logicalSearchId:t,conversationId:a,layoutType:i,resultsView:s,part:e.part,verticalType:e.verticalType,pageNumber:e.pageNumber,metadata:e.metadata});Object(o.a)({eventType:"USAGE",name:"ClientLayout",properties:Object(r.__assign)(Object(r.__assign)({},c(p)),{nameDetail:d})})}function h(e){var t=e.logicalSearchId,a=e.conversationId,r=e.traceId,i=e.status,n=e.providerName,s=e.latency,c=e.requestParams;Object(o.a)({eventType:"USAGE",name:"ResponseReceived",properties:{LogicalId:t,ConversationId:a,Version:2,TraceId:r,Status:i,ProviderName:n,Latency:s,nameDetail:n,RequestParams:JSON.stringify(c)}})}var m=a("xo1z"),I=a("D7WJ"),v=a("Wr3k"),y=a("7vLv"),g=a("1gqI"),T=void 0,f=["consumer","global","groupscoped","person","scoped"],S=["teamsitesearch","hubsitesearch","commsitesearch"],b=["sphomeweb","officehome","msw"];function O(e,t,a,r,i,n,o,s){return new w(e,t,a,r,i,n,o,s)}var w=function(){function e(e,t,a,r,i,n,o,s){this.fetchStartTime=e,this.searchTextCharacteristics=t,this.logicalSearchId=a,this.conversationId=r,this.items=i,this.instrumenter=n,this.activatedTime=o,this.inputTime=s,this.isDispatched=!1}return e.prototype.dispatch=function(){if(!this.isDispatched){this.isDispatched=!0,T=T&&T.logicalId===this.logicalSearchId?{logicalId:this.logicalSearchId,part:T.part+1}:{logicalId:this.logicalSearchId,part:0};var e={eventType:"USAGE",nameDetail:"Searchbox.Impression",name:"searchbox_impression",properties:{impressionId:this.logicalSearchId,conversationId:this.conversationId,fetchStartTime:Math.round(this.fetchStartTime),activatedTime:this.activatedTime&&Math.round(this.activatedTime),inputTime:this.inputTime&&Math.round(this.inputTime),characterCount:this.searchTextCharacteristics.characterCount,items:JSON.stringify(this.items.map((function(e){return Object(r.__assign)(Object(r.__assign)({},e),{emitTime:Math.round(e.emitTime),delayTime:Math.round(e.delayTime)})})))}};Object(o.a)(e),this.dispatchCachedContentRenderedByLogicalId(),this.dispatchResultsRenderedByTraceId(),l({logicalSearchId:this.logicalSearchId,conversationId:this.conversationId,layoutType:"Vertical",resultsView:this.getResultsViewForGroups(),nameDetail:"Searchbox.Impression",part:T.part,metadata:this.createMetadata()}),this.dispatchClientDataSourceAndResponseRecievedByTraceId()}},e.prototype.dispatchClientDataSourceAndResponseRecievedByTraceId=function(){var e,t,a=this,i=Object(m.a)(Object(d.a)())||Object(d.a)();if(0!==this.items.length){var n=Object(v.a)(this.items.filter((function(e){return"External"===e.entityType})),(function(e){return e.traceId}));try{for(var o=Object(r.__values)(Object.keys(n)),s=o.next();!s.done;s=o.next()){var c=s.value,u=n[c],l=u.map((function(e){return{Type:"External"===e.entityType?a.mapGroupIdToEntityType(e.groupId):e.entityType,ReferenceId:e.entityId}})),y=u[0].providerId;p({logicalSearchId:this.logicalSearchId,conversationId:this.conversationId,traceId:c,impressionType:"Suggestions",scenarioName:i,providerName:this.mapProviderIdToProviderName(y),dataSourceEntities:l,part:null==T?void 0:T.part,localTimeOverride:new Date((new Date).getTime()-(Object(I.a)()-(this.inputTime||this.fetchStartTime)))});var g=u[0],f=Math.round(g.emitTime-(this.inputTime||this.fetchStartTime));h({logicalSearchId:this.logicalSearchId,conversationId:this.conversationId,traceId:c,providerName:y,status:200,latency:f,requestParams:{QueryLength:this.searchTextCharacteristics.characterCount}})}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}}else this.dispatchEmptySuggestionInformation(i)},e.prototype.getResultsViewForGroups=function(){var e=this,t=Object(v.a)(this.items,(function(e){return e.groupId})),a=Object(y.a)(t,(function(t,a){return{Position:t[0].pos,ProviderId:t[0].traceId,Type:"Group",Name:e.mapGroupIdToGroupName(a),ReferenceId:Object(i.a)(),PlacementType:"Visible",LayoutType:"Vertical",ResultsView:e.getResultsViewForSuggestions(t)}}));return Object(g.a)(a,(function(e){return e.Position})).map((function(e,t){return Object(r.__assign)(Object(r.__assign)({},e),{Position:t+1})}))},e.prototype.getResultsViewForSuggestions=function(e){var t=this;return e.map((function(e,a){var r="External"===e.entityType?t.mapGroupIdToEntityType(e.groupId):e.entityType;return{Position:a+1,ProviderId:e.traceId,Type:"Entity",EntityType:r,ReferenceId:e.entityId,PlacementType:"Visible"}}))},e.prototype.mapGroupIdToGroupName=function(e){switch(null==e?void 0:e.toLowerCase()){case"peoplepill":return"person";default:return e}},e.prototype.mapGroupIdToEntityType=function(e){switch(null==e?void 0:e.toLowerCase()){case"file":return"File";case"site":return"Site";case"news":return"News";case"app":return"App";case"person":case"peoplepill":return"People";case"bookmark":return"Bookmark";case"querysuggestion":case"querysuggestionprovider":return"TextualSuggestion";default:return"External"}},e.prototype.mapProviderIdToProviderName=function(e){switch(null==e?void 0:e.toLowerCase()){case"querysuggestionprovider":return"SpoTenantTrendingQueriesProvider";default:return e}},e.prototype.dispatchCachedContentRenderedByLogicalId=function(){var e,t,a,i=Object(v.a)(this.items,(function(e){return e.fromCache})).true,s=Object(v.a)(i,(function(e){return e.originalLogicalSearchId}));try{for(var c=Object(r.__values)(Object.keys(s)),d=c.next();!d.done;d=c.next()){var p=d.value;a={logicalSearchId:this.logicalSearchId,originalLogicalSearchId:p,conversationId:this.conversationId,localTimeOverride:new Date((new Date).getTime()-(Object(I.a)()-(this.inputTime||this.fetchStartTime)))},Object(o.a)({eventType:"USAGE",name:"CachedContentRendered",properties:{nameDetail:a.nameDetail,LogicalId:a.originalLogicalSearchId,NewLogicalId:a.logicalSearchId,ConversationId:a.conversationId,Version:2,LocalTime:Object(n.a)(a.localTimeOverride||new Date)}})}}catch(t){e={error:t}}finally{try{d&&!d.done&&(t=c.return)&&t.call(c)}finally{if(e)throw e.error}}},e.prototype.dispatchResultsRenderedByTraceId=function(){var e,t,a,i=Object(v.a)(this.items,(function(e){return e.traceId}));try{for(var n=Object(r.__values)(Object.keys(i)),s=n.next();!s.done;s=n.next()){var c=s.value,d=i[c][0];a={logicalSearchId:this.logicalSearchId,conversationId:this.conversationId,traceId:c,latency:Math.round(d.emitTime-(this.inputTime||this.fetchStartTime))},Object(o.a)({eventType:"USAGE",name:"ResultsRendered",properties:Object(r.__assign)(Object(r.__assign)({E2ELatency:a.latency},a.renderLatency),{LogicalId:a.logicalSearchId,ConversationId:a.conversationId,TraceId:a.traceId,Version:2,ProviderName:a.providerName,VerticalName:a.verticalName,VerticalId:a.verticalId,properties:JSON.stringify(a.properties),measures:JSON.stringify(a.measures),NavScenario:a.NavScenario,TabInBackground:a.isTabInBackground})})}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},e.prototype.dispatchEmptySuggestionInformation=function(e){var t=Object(i.a)(),a=Object(I.a)()-(this.inputTime||this.fetchStartTime);h({logicalSearchId:this.logicalSearchId,conversationId:this.conversationId,traceId:t,providerName:"EmptySuggestions",status:200,latency:a,requestParams:{QueryLength:this.searchTextCharacteristics.characterCount}}),p({logicalSearchId:this.logicalSearchId,conversationId:this.conversationId,traceId:t,impressionType:"Suggestions",scenarioName:e,providerName:"EmptySuggestions",dataSourceEntities:[],part:null==T?void 0:T.part,localTimeOverride:new Date((new Date).getTime()-(Object(I.a)()-(this.inputTime||this.fetchStartTime)))})},e.prototype.createMetadata=function(){if(this.instrumenter){var e={},t=this.instrumenter.props,a=t.spInfo,r=t.hostAppInfo;return a&&(e.WebId=a.webId,e.SiteId=a.siteId),r&&(r.scopeId&&f.indexOf(r.scopeId.toLowerCase())>-1?e.Scopes=r.scopeId:r.id&&(S.indexOf(r.id.toLowerCase())>-1?e.Scopes="scoped":b.indexOf(r.id.toLowerCase())>-1&&(e.Scopes="global"))),e}},e}()}}]);