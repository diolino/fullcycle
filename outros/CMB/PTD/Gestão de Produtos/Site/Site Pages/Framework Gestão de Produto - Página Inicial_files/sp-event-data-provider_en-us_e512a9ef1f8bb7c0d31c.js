define("3a71e4d3-e6f1-4f83-a3c7-59160c872159_0.1.0",["tslib","@ms/sp-telemetry","@microsoft/sp-image-helper","@microsoft/sp-lodash-subset","@ms/sp-dataproviders","@microsoft/sp-core-library","@microsoft/sp-page-context","@ms/i18n-utilities","@ms/sp-component-utilities","@microsoft/sp-http","@ms/odsp-utilities-bundle"],function(n,a,i,r,o,s,c,d,l,u,f){return function(e){var t={};function n(a){if(t[a])return t[a].exports;var i=t[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(a,i,function(t){return e[t]}.bind(null,i));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="mwqp")}({"17wl":function(e,t){e.exports=n},"2q6Q":function(e,t){e.exports=a},"8dK2":function(e,t){e.exports=i},"9rT2":function(e){e.exports=JSON.parse('{"t":"Unknown error happens.","e":"This Events list no longer exists. Try a different Events list."}')},Pk8u:function(e,t){e.exports=r},QZHX:function(e,t){e.exports=o},UWqr:function(e,t){e.exports=s},"X+PM":function(e,t){e.exports=c},Ycni:function(e,t){e.exports=d},"hiL/":function(e,t){e.exports=l},mwqp:function(e,t,n){"use strict";n.r(t),n.d(t,"EventDataProvider",function(){return U}),n.d(t,"EventsSearchDataProvider",function(){return N}),n.d(t,"EventsListDataProvider",function(){return j});var a=n("17wl"),i=n("X+PM"),r=n("vlQI"),o=n("Pk8u"),s=n("UWqr"),c=n("2q6Q"),d=n("hiL/"),l=n("y88i");function u(){return s._SPKillSwitch.isActivated("e9d08579-a002-4119-bd5d-b52687094d1f")}function f(){return s._SPKillSwitch.isActivated("e7a8878e-98e5-447b-b462-bcbb1df03ac8")}function p(){return s._SPFlight.isEnabled(60218)||1===c._SPPerfExperiment.getVariantAndTrackExperiment(c._PerformanceExperiment.SOXEventUpdate)}function m(){return s._SPFlight.isEnabled(60278)}function _(e){var t=new Date(e);return t.setDate(t.getDate()+1),t.toISOString().split("T")[0]}function h(e,t){return n="\n    <View>\n      <ViewFields>\n      ".concat(p()?'<FieldRef Name="BannerUrl" />':"",'\n      <FieldRef Name="Category" />\n        <FieldRef Name="EndDate" />\n        <FieldRef Name="EventDate" />\n        <FieldRef Name="ID" />\n        <FieldRef Name="Location" />\n        <FieldRef Name="Title" />\n        <FieldRef Name="fAllDayEvent" />\n        <FieldRef Name="_ModernAudienceTargetUserField" />\n      </ViewFields>\n      <Query>\n        <Where>\n          ').concat(function(e){return s._SPFlight.isEnabled(1634)?"\n      <And>\n        ".concat(e,'\n        <Neq>\n          <FieldRef Name="fRecurrence" />\n          <Value Type="Boolean">1</Value>\n        </Neq>\n      </And>\n    '):"\n      <And>\n        ".concat(e,'\n        <Eq>\n          <FieldRef Name="fRecurrence" />\n          <Value Type="Boolean">0</Value>\n        </Eq>\n      </And>\n    ')}(function(e,t){var n=function(e){return e.category?"\n      <Eq>\n        <FieldRef Name='Category' />\n        <Value Type='Choice'>".concat(l.HtmlEncoding.encodeText(e.category),"</Value>\n      </Eq>\n    "):""}(e),a=function(e,t){var n='\n      <Geq>\n        <FieldRef Name="EndDate" />\n        <Value IncludeTimeValue="True" Type="DateTime">\n          '.concat(e.startDate||"<Today />","\n        </Value>\n      </Geq>\n    "),a=e.endDate?'\n      <Lt>\n        <FieldRef Name="EventDate" />\n        <Value IncludeTimeValue="True" Type="DateTime">\n          '.concat(_(e.endDate),"\n        </Value>\n      </Lt>\n    "):"",i=e.startDate?b(e.startDate,t):"<Today />",r=e.endDate?b(_(e.endDate),t):"",o='\n        <Geq>\n          <FieldRef Name="EndDate" />\n          <Value IncludeTimeValue="True" Type="DateTime">\n            '.concat(i,"\n          </Value>\n        </Geq>\n      "),s=e.endDate?'\n      <Lt>\n        <FieldRef Name="EventDate" />\n        <Value IncludeTimeValue="True" Type="DateTime">\n          '.concat(r,"\n        </Value>\n      </Lt>\n    "):"",c='\n      <Neq>\n        <FieldRef Name="fAllDayEvent" />\n        <Value Type="Boolean">1</Value>\n      </Neq>\n    ';return a?"\n      <Or>\n        <And>\n          ".concat(c,"\n          <And>\n            ").concat(n,"\n            ").concat(a,'\n          </And>\n        </And>\n        <And>\n          <Eq>\n            <FieldRef Name="fAllDayEvent" />\n            <Value Type="Boolean">1</Value>\n          </Eq>\n          <And>\n            ').concat(o,"\n            ").concat(s,"\n          </And>\n        </And>\n      </Or>\n      "):"\n      <Or>\n        <And>\n          ".concat(c,"\n          ").concat(n,'\n        </And>\n        <And>\n          <Eq>\n            <FieldRef Name="fAllDayEvent" />\n            <Value Type="Boolean">1</Value>\n          </Eq>\n          ').concat(o,"\n        </And>\n      </Or>")}(e,t);return n?"\n      <And>\n        ".concat(a,"\n        ").concat(n,"\n      </And>\n    "):a}(e,t)),"\n        </Where>\n      </Query>\n      ").concat(function(e){return e.rowLimit?'<RowLimit Paged="FALSE">'.concat(e.rowLimit,"</RowLimit>"):""}(e),"\n    </View>\n  "),n.replace(/" \/>/g,'"/>').split(/(?:\r\n|\r|\n)/).map(function(e){return e.trim()}).join("");var n}function b(e,t){var n=new Date(e);return n.setMinutes(n.getMinutes()-t.offset),n.toISOString()}var g=n("Ycni"),v=function(){function e(){}return e.dateStringToUTCDate=function(t,n,a){if(e._allDayKillSwitch.isActivated())return new Date(t);var i=new Date(e.ensureISOTimestamp(t));if(!a)return i;var r=new g.SPDate({fullYear:i.getUTCFullYear(),month:i.getUTCMonth(),date:i.getUTCDate(),hours:i.getUTCHours(),minutes:i.getUTCMinutes(),seconds:i.getUTCSeconds(),milliseconds:i.getUTCMilliseconds()}),o=n?r.convertToUTC(n):r;return new Date(Date.UTC(o.fullYear,o.month,o.date,o.hours,o.minutes,o.seconds,o.milliseconds))},e.dateStringToLocalDate=function(t,n,a){var i=new Date(e.ensureISOTimestamp(t));if(!n)return i;var r=new g.SPDate({fullYear:i.getUTCFullYear(),month:i.getUTCMonth(),date:i.getUTCDate(),hours:i.getUTCHours(),minutes:i.getUTCMinutes(),seconds:i.getUTCSeconds(),milliseconds:i.getUTCMilliseconds()}),o=a?r:r.convertFromUTC(n);return new Date(o.fullYear,o.month,o.date,o.hours,o.minutes,o.seconds)},e.localToUtc=function(e,t){if(!t)return e;var n=new g.SPDate({fullYear:e.getFullYear(),date:e.getDate(),month:e.getMonth(),hours:e.getHours(),minutes:e.getMinutes(),seconds:e.getSeconds()}).convertToUTC(t);return new Date(Date.UTC(n.fullYear,n.month,n.date,n.hours,n.minutes,n.seconds))},e.ensureISOTimestamp=function(e){if(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.?[0-9]*Z$/i.test(e))return e;if(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.?[0-9]*$/i.test(e))return"".concat(e.substring(0,19),"Z");throw new Error("EventTimeZoneUtilities: date time string ".concat(e," is not supported"))},e.getUTCMilliseconds=function(e){return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())},e._allDayKillSwitch=new d.KillSwitch("5a511229-1361-450b-a2ac-61bdf600d687"),e}(),y=n("8dK2"),S=n("9rT2"),D="7F759147-C861-4CD6-A11F-5AA3037D9634";function I(e,t){return{FieldName:e,FieldValue:t}}function x(e){return"".concat(e<10?"0":"").concat(e)}function C(e){return"".concat(e.getFullYear(),"-").concat(x(e.getMonth()+1),"-").concat(x(e.getDate()))+" ".concat(x(e.getHours()),":").concat(x(e.getMinutes()),":").concat(x(e.getSeconds()))}function O(e,t,n){if(t){var a=s._SPKillSwitch.isActivated("ad3c840c-8bc3-447e-888d-8f1a0311b3dc")?"".concat(e.getFullYear(),"-").concat(x(e.getMonth()+1),"-").concat(x(e.getDate()),"T00:00:00.000Z"):"".concat(e.getFullYear(),"-").concat(x(e.getMonth()+1),"-").concat(x(e.getDate()),"T12:00:00.000Z");return v.dateStringToLocalDate(a,n,!1)}return e}function w(e,t,n,a){var i={formValues:[I("Title",e.title),I("Category",e.category?e.category instanceof Array?JSON.stringify(e.category):e.category:""),I("Description",e.description),I("Location",e.location),I("EventDate",C(O(e.startTime,e.isAllDayEvent,n))),I("EndDate",C(O(e.endTime,e.isAllDayEvent,n))),I("fAllDayEvent",e.isAllDayEvent?"true":"false"),I("Workspace",e.linkUrl?"".concat(e.linkUrl,", ").concat(e.linkName):""),I("BannerUrl",e.bannerUrl),I("ParticipantsPicker",JSON.stringify(t.map(function(e){return{Key:e}}))),I("Geolocation",e.geolocation?"Point (".concat(e.geolocation.longitude," ").concat(e.geolocation.latitude,")"):"")],bNewDocumentUpdate:!1,checkInComment:null};return e.audiences&&i.formValues.push(I("_ModernAudienceTargetUserField",JSON.stringify(e.audiences.map(function(e){return{Key:e}})))),a&&i.formValues.push(I("BannerImageUrl",e.bannerImageUrl)),i}function E(e){return e.status>=200&&e.status<300?204===e.status?Promise.resolve():e.json():e.json().then(function(t){throw P(e.correlationId,e.status,t.error)})}function A(e){return e.status>=200&&e.status<300?Promise.resolve(!0):e.json().then(function(t){var n;if(400===e.status&&"string"==typeof(null===(n=t.error)||void 0===n?void 0:n.message)&&t.error.message.indexOf(D))return Promise.resolve(!1);throw P(e.correlationId,e.status,t.error)})}function L(e){var t=new c._QosMonitor("EventDataProvider.GetBannerImageUrlField");return e.status>=200&&e.status<300?(t.writeSuccess(),Promise.resolve(!0)):e.json().then(function(n){var i=P(e.correlationId,e.status,n.error);return t.writeUnexpectedFailure("Unexpected",void 0,Object(a.__assign)(Object(a.__assign)({},i),{name:"BannerImageUrlError"})),Promise.reject(!1)})}function k(e){var t=e.value.filter(function(e){return 0!==e.ErrorCode});if(t.length>0)throw{correlationId:s.Guid.empty,httpStatus:200,code:t[0].ErrorCode.toString(),message:t[0].ErrorMessage};return e.value.filter(function(e){return"Id"===e.FieldName})[0].FieldValue}function M(e){if(e)try{var t=new y._SPResourcePath(e).getQueryParameter("ar"),n=t?parseFloat(t):void 0;if(!n||isNaN(n)||!isFinite(n)||n<=0)return;return n}catch(e){return}}function P(e,t,n){var a=n||{code:"UnknownErrorCode",message:S.t};return{correlationId:e,httpStatus:t,code:a.code,message:"string"==typeof a.message?a.message:a.message.value}}var T=n("QZHX"),U=function(){function e(t){var n=this;this.id="Event",this.title="EventDataProvider",this.extraData={},this.qosMonitorLabel="EventDataSource",this._eventToETag=new Map,this._fetchEventData=function(t){var i;return n._afterServiceScopeFinished().then(function(o){var c=o.pageContext,d=o.httpClient,l=s.UrlUtilities.removeEndSlash(c.web.absoluteUrl);i=n._getTimeZoneFromPageContext(c);var u=t.listId.toString(),f=n._buildQueryString(t),p="".concat(l,"/_api/web/Lists(guid'").concat(u,"')/RenderListDataAsStream?").concat(f),m=JSON.stringify({parameters:Object(a.__assign)({__metadata:{type:"SP.RenderListDataParameters"},DatesInUtc:!0,RenderOptions:3,ViewXml:h(t,i),AudienceTarget:t.audienceTarget},!!t.cdnRewriteBannerUrl&&{ImageFieldsToTryRewriteToCdnUrls:"BannerUrl"})}),_={alias:e.aliasPrefix+n.id,id:t.webpartId,expirationDuration:6e5,cacheStrategy:r._CacheStrategy.CacheAndNetwork,extraProps:new Map([[T.TieredCacheHelper.useStalePropName,!0]])};return d.fetch(p,r.SPHttpClient.configurations.v1,{body:m,headers:{Accept:"application/json;odata=verbose","Content-Type":"application/json;odata=verbose","Odata-Version":"3.0"},method:"POST"},_)})},this._parseSPHttpClientResponse=function(e,t,a){return n.extraData.correlationId="".concat(e.correlationId),n.extraData.responseStatus="".concat(e.status),n.extraData.message=e.statusMessage,n.extraData.cacheStatus="None",e.ok?204===e.status?Promise.resolve():e.json().then(function(e){return n._processRawData(e,t,a)}).catch(function(e){throw a.writeUnexpectedFailure("Unexpected",e),e}):e.json().then(function(t){var n=new Error(e.statusMessage);throw a.writeUnexpectedFailure("Unexpected",n),P(e.correlationId,e.status,t.error)}).catch(function(e){throw e})},this._isRawData=function(e){return!!(e&&e.ListData&&e.ListData.Row instanceof Array)},this._processRawData=function(e,t,a){if(n._isRawData(e)){var i=e.ListData.Row.map(function(a){var i;return{id:a.ID,category:a.Category,title:n._htmlDecode(a.Title),description:void 0,startTime:v.dateStringToLocalDate(a.EventDate,t.timeZone,"1"===a["fAllDayEvent.value"]),endTime:v.dateStringToLocalDate(a.EndDate,t.timeZone,"1"===a["fAllDayEvent.value"]),allDay:"1"===a["fAllDayEvent.value"],location:n._htmlDecode(a.Location),attendees:void 0,containsAudiences:Boolean(null===(i=a._ModernAudienceTargetUserField)||void 0===i?void 0:i.length),prevPageQuery:n._constructPageQuery(e.ListData.PrevHref),nextPageQuery:n._constructPageQuery(e.ListData.NextHref),geolocation:void 0,linkUrl:"",linkName:"",bannerUrl:p()?String(a.BannerUrl):void 0,webName:"",webUrl:""}});return null==a||a.writeSuccess(n.extraData),i}throw new Error(S.e)},this._isEmptyResponse=function(e){return!(null==e?void 0:e.length)},this.options=t,this._serviceScope=t.serviceScope}return e.prototype.requestData=function(e){return e.listId?e.startDate&&e.endDate&&new Date(e.startDate)>new Date(e.endDate)?Promise.resolve([]):s._SPFlight.isEnabled(60402)||1===c._SPPerfExperiment.getVariantAndTrackExperiment(c._PerformanceExperiment.WEXMySiteCacheTCExpEvents)?this.executeRequest(e):this.executeRequest_legacy(e):Promise.resolve([])},e.prototype.executeRequest=function(e){var t,n=this;return this._afterServiceScopeFinished().then(function(a){var i=a.pageContext;t=t=n._getTimeZoneFromPageContext(i),e.timeZone=t;var r={parseHttpClientResponse:n._parseSPHttpClientResponse,isEmptyResponse:n._isEmptyResponse,isRawData:n._isRawData,processRawData:n._processRawData,qosMonitorLabel:n.qosMonitorLabel,onServerResponseResolvedWithCache:e.onServerResponseResolvedWithCache,onServerResponseResolved:e.onServerResponseResolved,onServerResponseFailed:e.onServerResponseFailed,onCacheResponseResolved:e.onCacheResponseResolved,onCacheResponseFailed:e.onCacheResponseFailed};return T.TieredCacheHelper.executeCacheStrategy(r,n._fetchEventData,e)})},e.prototype.executeRequest_legacy=function(e){var t,n=this;return this._afterServiceScopeFinished().then(function(i){var o=i.pageContext,c=i.httpClient,d=s.UrlUtilities.removeEndSlash(o.web.absoluteUrl);t=n._getTimeZoneFromPageContext(o);var l=e.listId.toString(),u=n._buildQueryString(e),f="".concat(d,"/_api/web/Lists(guid'").concat(l,"')/RenderListDataAsStream?").concat(u),p=JSON.stringify({parameters:Object(a.__assign)({__metadata:{type:"SP.RenderListDataParameters"},DatesInUtc:!0,RenderOptions:3,ViewXml:h(e,t),AudienceTarget:e.audienceTarget},!!e.cdnRewriteBannerUrl&&{ImageFieldsToTryRewriteToCdnUrls:"BannerUrl"})});return c.post(f,r.SPHttpClient.configurations.v1,{body:p,headers:{Accept:"application/json;odata=verbose","Content-Type":"application/json;odata=verbose","Odata-Version":"3.0"}})}).then(E).then(function(e){if(e&&e.ListData&&e.ListData.Row instanceof Array)return e.ListData.Row.map(function(a){var i;return{id:a.ID,category:a.Category,title:n._htmlDecode(a.Title),description:void 0,startTime:v.dateStringToLocalDate(a.EventDate,t,"1"===a["fAllDayEvent.value"]),endTime:v.dateStringToLocalDate(a.EndDate,t,"1"===a["fAllDayEvent.value"]),allDay:"1"===a["fAllDayEvent.value"],location:n._htmlDecode(a.Location),attendees:void 0,containsAudiences:(null===(i=a._ModernAudienceTargetUserField)||void 0===i?void 0:i.length)>0,prevPageQuery:n._constructPageQuery(e.ListData.PrevHref),nextPageQuery:n._constructPageQuery(e.ListData.NextHref),geolocation:void 0,linkUrl:"",linkName:"",bannerUrl:p()?String(a.BannerUrl):void 0,bannerImageAspectRatio:f()?void 0:M(String(a.BannerUrl)),webName:"",webUrl:""}});throw new Error(S.e)})},e.prototype.requestEventItem=function(e,t){return this._requestEventItem(e,t,!1)},e.prototype.requestUTCEventItem=function(e,t,n){return this._requestEventItem(t,n,!0,e)},e.prototype.updateEventItem=function(e,t,n){var a,i=this;return this._afterServiceScopeFinished().then(function(o){var c=o.pageContext,d=o.httpClient,l=s.UrlUtilities.removeEndSlash(c.web.absoluteUrl);a="".concat(l,"/_api/web/Lists(guid'").concat(e.toString(),"')/items('").concat(t,"')/ValidateUpdateListItem()");var u={"If-Match":i._eventToETag.get(a),"Content-Type":"application/json;charset=utf-8"};return i._getEventPeopleIds(n.attendees).then(function(t){return i._getBannerImageUrlEnabledPromise(e,l).then(function(e){var o=JSON.stringify(w(n,t.map(function(e){return e.UserPrincipalName||e.LoginName}),i._getTimeZoneFromPageContext(c),e));return d.post(a,r.SPHttpClient.configurations.v1,{headers:u,body:o})})})}).then(function(e){return E(e).then(function(){return e})}).then(function(e){i._eventToETag.set(a,e.headers.get("ETag"))})},e.prototype.deleteEventItem=function(e,t){var n,a=this;return this._afterServiceScopeFinished().then(function(i){var o=i.pageContext,c=i.httpClient,d=s.UrlUtilities.removeEndSlash(o.web.absoluteUrl),l="".concat(d,"/_api/web/Lists(guid'").concat(e.toString(),"')/items(").concat(t,")"),f="".concat(l,"/recycle");n=u()?l:f;var p={"If-Match":a._eventToETag.get(n)},m=u()?"DELETE":"POST";return c.fetch(n,r.SPHttpClient.configurations.v1,{headers:p,method:m})}).then(E).then(function(){a._eventToETag.delete(n)}).catch(function(e){if("-2130575234, Microsoft.SharePoint.SPException"!==e.code)throw e;c._EngagementLogger.logEvent("EventDataProvider.DeleteEventItemFailure.HasSkypeLink")})},e.prototype.createEventItem=function(e,t){var n=this;return this._afterServiceScopeFinished().then(function(a){var i=a.pageContext,o=a.httpClient,c=s.UrlUtilities.removeEndSlash(i.web.absoluteUrl),d="".concat(c,"/_api/web/Lists(guid'").concat(e.toString(),"')/AddValidateUpdateItemUsingPath()"),l={Accept:"application/json","Content-Type":"application/json;charset=utf-8"};return n._getEventPeopleIds(t.attendees).then(function(a){return n._getBannerImageUrlEnabledPromise(e,c).then(function(e){var s=JSON.stringify(w(t,a.map(function(e){return e.UserPrincipalName||e.LoginName}),n._getTimeZoneFromPageContext(i),e));return o.post(d,r.SPHttpClient.configurations.v1,{headers:l,body:s})})})}).then(E).then(k).then(function(t){return n.requestEventItem(e,t)})},e.prototype.getAllCategories=function(e){return Promise.all([this.getInUsedCategories(e),this.getPreDefinedCategories(e)]).then(function(e){var t=e[0],n=e[1];return Object(o.uniq)(Object(a.__spreadArray)(Object(a.__spreadArray)([],t,!0),n.categories,!0)).sort()})},e.prototype.getPreDefinedCategories=function(e){return this._afterServiceScopeFinished().then(function(t){var n=t.pageContext,i=t.httpClient,o=s.UrlUtilities.removeEndSlash(n.web.absoluteUrl),c="".concat(o,"/_api/web/Lists(guid'").concat(e.toString(),"')/fields/GetByInternalNameOrTitle('Category')");return i.get(c,r.SPHttpClient.configurations.v1).then(E).then(function(e){return{categories:Object(a.__spreadArray)([],e.Choices,!0),type:e.TypeAsString}})})},e.prototype.getInUsedCategories=function(e){var t=this;return this._afterServiceScopeFinished().then(function(n){var a=n.pageContext,i=n.httpClient,r=s.UrlUtilities.removeEndSlash(a.web.absoluteUrl);return t._getViewId(r,e.toString(),i).then(function(n){return t._getCategoriesFromView(r,e.toString(),i,n)})})},e.prototype.convertDisplayedDateToUTC=function(e){var t=this;return this._afterServiceScopeFinished().then(function(n){var a=n.pageContext;return v.localToUtc(e,t._getTimeZoneFromPageContext(a))})},e.prototype.getAudienceTargetEnabledFlag=function(e){return this._afterServiceScopeFinished().then(function(t){var n=t.pageContext,a=t.httpClient,i=s.UrlUtilities.removeEndSlash(n.web.absoluteUrl),o="".concat(i,"/_api/web/Lists(guid'").concat(e.toString(),"')/Fields(guid'").concat(D,"')");return a.get(o,r.SPHttpClient.configurations.v1,{headers:{Accept:"application/json","Content-Type":"application/json;charset=utf-8"}})}).then(A)},e.prototype._getBannerImageUrlEnabledPromise=function(e,t){return m()?this._afterServiceScopeFinished().then(function(n){var a=n.pageContext,i=n.httpClient;t=t||s.UrlUtilities.removeEndSlash(a.web.absoluteUrl);var o="".concat(t,"/_api/web/Lists(guid'").concat(e.toString(),"')/Fields(guid'").concat("8A4BE162-151D-4A11-b9BE-E7DC05196D73","')");return i.get(o,r.SPHttpClient.configurations.v1,{headers:{Accept:"application/json","Content-Type":"application/json;charset=utf-8"}})}).then(L).catch(function(){return!1}):Promise.resolve(!1)},e.prototype._getViewId=function(e,t,n){var a="".concat(e,"/_api/web/Lists/GetById('").concat(t,"')/Views?$select=Id&$filter=BaseViewId eq '1'");return n.get(a,r.SPHttpClient.configurations.v1).then(E).then(function(e){return e.value&&e.value.length>0?e.value[0].Id:Promise.reject(new Error("No view is found."))})},e.prototype._getCategoriesFromView=function(e,t,n,a){var i=this,c="".concat(e,"/_api/web/Lists/GetById('").concat(t,"')/RenderListFilterData")+"?FieldInternalName='Category'&ViewId='".concat(a,"'");return n.post(c,r.SPHttpClient.configurations.v1,{}).then(function(e){if(e.ok)return e.text();throw new Error(JSON.stringify(e))}).then(function(e){var t=new RegExp('Value="([^"]*)',"g"),n=(s._SPKillSwitch.isActivated("45a6cd0d-a152-4b4d-a841-7d9534f67273")?e.match(t):e.match(t)||[]).map(function(e){return e.replace(t,"$1")}).map(i._htmlDecode);return Object(o.uniq)(n)})},e.prototype._mapRESTResponseEvent=function(e,t,n){var a=this;return void 0===n&&(n=!1),this._getEventAttachments(e).then(function(r){return{id:e.ID.toString(),category:e.Category,title:e.Title,description:e.Description,startTime:n?v.dateStringToUTCDate(e.EventDate,t,e.fAllDayEvent):v.dateStringToLocalDate(e.EventDate,t,e.fAllDayEvent),endTime:n?v.dateStringToUTCDate(e.EndDate,t,e.fAllDayEvent):v.dateStringToLocalDate(e.EndDate,t,e.fAllDayEvent),location:e.Location,attendees:a._mapRESTResponsePeople(e.ParticipantsPicker),audiences:a._mapRESTResponseAudience(e.OData__ModernAudienceTargetUserField,e["OData__ModernAudienceTargetUserField@odata.navigationLink"]),bannerUrl:e.BannerUrl?e.BannerUrl.Url:"",attachments:r,linkName:e.Workspace?e.Workspace.Description:"",linkUrl:e.Workspace?e.Workspace.Url:"",isAllDayEvent:e.fAllDayEvent,geolocation:e.Geolocation?{latitude:e.Geolocation.Latitude,longitude:e.Geolocation.Longitude}:void 0,permission:new i.SPPermission(e.EffectiveBasePermissions),isRecurrence:e.fRecurrence,prevPageQuery:void 0,nextPageQuery:void 0,webName:"",webUrl:""}})},e.prototype._getEventAttachments=function(e){var t=this;return this._afterServiceScopeFinished().then(function(n){var a=n.pageContext,i=n.httpClient,o=s.UrlUtilities.removeEndSlash(a.web.absoluteUrl);if(e.Attachments){var c=i.beginBatch(),d=e.AttachmentFiles.map(function(e){return e.ServerRelativeUrl}).map(function(e){var t="".concat(o,"/_api/web/getFileByUrl('").concat(e,"')");return c.get(t,r.SPHttpClientBatch.configurations.v1,{headers:{Accept:"application/json","Content-Type":"application/json;charset=utf-8"}}).then(function(e){return E(e)})});return c.execute().then(function(){return Promise.all(d)}).then(t._mapRESTAttachments)}return Promise.resolve([])})},e.prototype._getEventPeopleIds=function(e){return(null==e?void 0:e.length)?this._afterServiceScopeFinished().then(function(t){var n=t.pageContext,a=t.httpClient,i=s.UrlUtilities.removeEndSlash(n.web.absoluteUrl),o=a.beginBatch(),c=e.map(function(e){var t="".concat(i,"/_api/web/ensureUser(@user)?@user='").concat(encodeURIComponent(e.id),"'");return o.get(t,r.SPHttpClientBatch.configurations.v1).then(E).then(function(e){return e})});return o.execute().then(function(){return Promise.all(c)})}):Promise.resolve([])},e.prototype._requestEventItem=function(e,t,n,a){var i,o,c=this;return void 0===n&&(n=!1),this._afterServiceScopeFinished().then(function(n){var d=n.pageContext,u=n.httpClient;o=c._getTimeZoneFromPageContext(d),a=a||s.UrlUtilities.removeEndSlash(d.web.absoluteUrl);var f=["Attachments","BannerUrl","Category","Description","EffectiveBasePermissions","EndDate","EventDate","fAllDayEvent","ID","Location","ParticipantsPicker/Name","ParticipantsPicker/Title","Title","Workspace","fRecurrence","Geolocation"],p=["AttachmentFiles","ParticipantsPicker"];i="".concat(a,"/_api/web/Lists(guid'").concat(e.toString(),"')/items(").concat(t,")");var m={Accept:"application/json","Content-Type":"application/json;charset=utf-8"},_=c.getAudienceTargetEnabledFlag(e),h=new l.Uri(a),b=new l.Uri(d.web.absoluteUrl),g=h.getScheme()+"://"+h.getHost();return(g===b.getScheme()+"://"+b.getHost()?Promise.resolve():r._AadTokenProviders.configurable._getTokenInternal(g,r._AadTokenProviders.preAuthorizedConfiguration).then(function(e){return m.Authorization="Bearer ".concat(e),Promise.resolve()},function(){return Promise.resolve()})).then(function(){return _}).then(function(e){return e&&(f.push("OData__ModernAudienceTargetUserField/Name"),p.push("OData__ModernAudienceTargetUserField")),Promise.resolve(!0)},function(){return Promise.resolve(!0)}).then(function(){var e="$select=".concat(f.join(","),"&$expand=").concat(p.join(",")),t="".concat(i,"/?").concat(e);return u.get(t,r.SPHttpClient.configurations.v1,{headers:m})})}).then(E).then(function(e){return c._eventToETag.set(i,e["@odata.etag"]),c._mapRESTResponseEvent(e,o,n)})},e.prototype._afterServiceScopeFinished=function(){var e=this;return new Promise(function(t){e._serviceScope.whenFinished(function(){t({pageContext:e._serviceScope.consume(i.PageContext.serviceKey),httpClient:e._serviceScope.consume(r.SPHttpClient.serviceKey)})})})},e.prototype._buildQueryString=function(e){if(e.pageQuery)return e.pageQuery;var t=[];return e.orderBy&&t.push(["SortField",e.orderBy.field],["SortDir",e.orderBy.direction]),t.map(function(e){return e.join("=")}).join("&")},e.prototype._mapRESTResponsePeople=function(e){return e?e.map(function(e){return{id:e.Name,name:e.Title}}):[]},e.prototype._mapRESTResponseAudience=function(e,t){return e?e.map(function(e){return function(e){var t;return(null===(t=e.Name)||void 0===t?void 0:t.length)>=36?e.Name.substr(e.Name.length-36):""}(e)}):t?[]:void 0},e.prototype._mapRESTAttachments=function(e){return e?e.map(function(e){return{fileName:e.Name,fileSize:e.Length,filePreviewUrl:e.LinkingUri,fileRelativeUrl:e.ServerRelativeUrl}}):[]},e.prototype._constructPageQuery=function(e){return e?e.substr(1).replace("&View=00000000-0000-0000-0000-000000000000",""):""},e.prototype._getTimeZoneFromPageContext=function(e){return e.user.preferUserTimeZone?e.user.timeZoneInfo:e.web.timeZoneInfo},e.prototype._htmlDecode=function(e){return e?(new DOMParser).parseFromString(e,"text/html").body.innerText:e},e.aliasPrefix="FirstParty_EventsWebPart_",Object(a.__decorate)([Object(d.monitor)("EventDataProvider.RequestData")],e.prototype,"requestData",null),Object(a.__decorate)([Object(d.monitor)("EventDataProvider.UpdateEventItem")],e.prototype,"updateEventItem",null),Object(a.__decorate)([Object(d.monitor)("EventDataProvider.DeleteEventItem")],e.prototype,"deleteEventItem",null),Object(a.__decorate)([Object(d.monitor)("EventDataProvider.CreateEventItem")],e.prototype,"createEventItem",null),Object(a.__decorate)([Object(d.monitor)("EventDataProvider.GetPreDefinedCategories")],e.prototype,"getPreDefinedCategories",null),Object(a.__decorate)([Object(d.monitor)("EventDataProvider.GetInUsedCategories")],e.prototype,"getInUsedCategories",null),Object(a.__decorate)([Object(d.monitor)("EventDataProvider.GetAudienceTargetEnabledFlag")],e.prototype,"getAudienceTargetEnabledFlag",null),Object(a.__decorate)([Object(d.monitor)("EventDataProvider.GetEventAttachments")],e.prototype,"_getEventAttachments",null),Object(a.__decorate)([Object(d.monitor)("EventDataProvider.GetEventPeopleIds")],e.prototype,"_getEventPeopleIds",null),Object(a.__decorate)([Object(d.monitor)("EventDataProvider.RequestEventItem")],e.prototype,"_requestEventItem",null),e}(),F='EventsRollUpEndDate >="',H='EventsRollUpStartDate<"',R='"',N=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._mapResponse=function(e){var n=t._pageContext.user.preferUserTimeZone?t._pageContext.user.timeZoneInfo:t._pageContext.web.timeZoneInfo,a=e.rows.map(function(e){var t,a="true"===e.IsAllDayEvent,i=v.dateStringToLocalDate(e.EventsRollUpStartDate.toString(),n,a),r=v.dateStringToLocalDate(e.EventsRollUpEndDate.toString(),n,a),o="";return p()&&(e.PictureThumbnailURL?o=e.PictureThumbnailURL:e.BannerUrlOWSURLH&&(o=e.BannerUrlOWSURLH.split(",")[0])),{endTime:r,isAllDayEvent:a,startTime:i,id:e.ListItemID,attendees:void 0,audiences:void 0,bannerUrl:o,bannerImageAspectRatio:f()?void 0:M(String(null===(t=e.BannerUrlOWSURLH)||void 0===t?void 0:t.split(",")[0])),category:e.EventsRollUpCategory?e.EventsRollUpCategory.toString():"",description:void 0,geolocation:void 0,linkName:void 0,linkUrl:void 0,listId:e.ListID,location:e.Location?e.Location.toString():"",nextPageQuery:void 0,prevPageQuery:void 0,title:e.Title,webName:e.SiteTitle?e.SiteTitle:"",webUrl:e.SPWebUrl?e.SPWebUrl.toString():"",containsAudiences:Boolean(e.ModernAudienceAadObjectIds)}});return Promise.resolve(a)},t._filterSearchResults=function(e,n){if(void 0!==e&&e.length>0&&n){var a=t._regexMatchQuery(n,F,R);if(a){var i=t._regexMatchQuery(n,H,R);if(i){var r=t._pageContext.user.preferUserTimeZone?t._pageContext.user.timeZoneInfo:t._pageContext.web.timeZoneInfo,o=v.dateStringToLocalDate(a,r,!1),s=v.dateStringToLocalDate(i,r,!1),c=v.getUTCMilliseconds(o),d=v.getUTCMilliseconds(s),l=e.filter(function(e){var t=v.getUTCMilliseconds(e.startTime),n=v.getUTCMilliseconds(e.endTime);return!e.isAllDayEvent||t>=c&&n<d});return Promise.resolve(l)}}}return Promise.resolve(e)},t._regexMatchQuery=function(e,t,n){var a,i=null===(a=null==e?void 0:e.QueryTemplate)||void 0===a?void 0:a.match(t+"(.*?)"+n);return i?i[1]:""},t}return Object(a.__extends)(t,e),Object.defineProperty(t,"selectProperties",{get:function(){var e=["EventsRollUpCategory","EventsRollUpEndDate","EventsRollUpStartDate","IsAllDayEvent","ListID","ListItemID","Location","SiteTitle","SPWebUrl","Title"];return p()&&m()&&(e.push("BannerUrlOWSURLH"),e.push("PictureThumbnailURL")),e},enumerable:!1,configurable:!0}),t.prototype.requestData=function(t){var n=this;return s._SPKillSwitch.isActivated("dffb2f88-0ca6-4e97-b318-a4bc1e3822c2")?e.prototype.requestData.call(this,t):e.prototype.requestData.call(this,t).then(function(e){return n._filterSearchResults(e,t.searchAPIQueryOptions)})},t}(T.SearchDataProvider),B=[-2130575322,-2147024891],j=function(){function e(e){this._serviceScope=e}return e.prototype.getEventsLists=function(){var e=this;return this._afterServiceScopeFinished().then(function(t){var n=t.pageContext,a=t.httpClient,i=n.web.absoluteUrl,o="".concat(i,"/_api/web/Lists?$filter=BaseTemplate eq 106&$select=Id,Title");return a.get(o,r.SPHttpClient.configurations.v1).then(e._parseResponse).then(function(e){return e.value})})},e.prototype.ensureEventsList=function(){var e=this;return this._afterServiceScopeFinished().then(function(t){var n=t.pageContext,a=t.httpClient,i=n.web.absoluteUrl,o="".concat(i,"/_api/Lists/EnsureEventsList?$select=Title,Id");return a.post(o,r.SPHttpClient.configurations.v1,{}).then(e._parseResponse)})},e.prototype.getEventsListPermission=function(e){var t=this;return e?this._afterServiceScopeFinished().then(function(n){var a=n.pageContext,o=n.httpClient,s=a.web.absoluteUrl,c="".concat(s,"/_api/web/Lists(guid'").concat(e,"')/EffectiveBasePermissions");return o.get(c,r.SPHttpClient.configurations.v1).then(t._parseResponse).then(function(e){return new i.SPPermission(e)}).catch(function(e){return B.forEach(function(t){if(-1!==e.code.indexOf(String(t)))throw new d.ExpectedFailure("SPErrorCode_".concat(e.code),e.message,{correlationId:e.correlationId?e.correlationId.toString():void 0})}),Promise.reject(e)})}):Promise.resolve(void 0)},e.prototype._afterServiceScopeFinished=function(){var e=this;return new Promise(function(t){e._serviceScope.whenFinished(function(){t({pageContext:e._serviceScope.consume(i.PageContext.serviceKey),httpClient:e._serviceScope.consume(r.SPHttpClient.serviceKey)})})})},e.prototype._parseResponse=function(e){return e.status>=200&&e.status<300?204===e.status?Promise.resolve():e.json():e.json().then(function(t){var n=t.error||{code:"UnknownErrorCode",message:S.t};throw{correlationId:e.correlationId,httpStatus:e.status,code:n.code,message:"string"==typeof n.message?n.message:n.message.value}})},Object(a.__decorate)([Object(d.monitor)("EventDataProvider.GetEventsLists")],e.prototype,"getEventsLists",null),Object(a.__decorate)([Object(d.monitor)("EventDataProvider.EnsureEventsList")],e.prototype,"ensureEventsList",null),Object(a.__decorate)([Object(d.monitor)("EventDataProvider.GetEventsListPermission")],e.prototype,"getEventsListPermission",null),e}()},vlQI:function(e,t){e.exports=u},y88i:function(e,t){e.exports=f}})});